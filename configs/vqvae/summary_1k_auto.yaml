# VQ-VAE Training Config for SUMMARY Features (1K dataset) - AUTO CATEGORY DISCOVERY
#
# Trains categorical hierarchical VQ-VAE on aggregated SUMMARY v2.0 features
# using automatic clustering-based category discovery.
#
# This config uses the proven encoder architecture from unisim's U token training.

# Dataset
dataset_path: "datasets/test_1k_inline_features.h5"

# Feature Families
families:
  summary:
    encoder: MLPEncoder
    encoder_params:
      hidden_dims: [256, 128]
      output_dim: 64
      dropout: 0.1
      activation: "relu"
      batch_norm: true

# VQ-VAE Architecture
model:
  group_embedding_dim: 64
  group_hidden_dim: 128

  # Hierarchical levels (uniform across categories)
  # Based on unisim's proven 3-level hierarchy
  levels:
    - {latent_dim: 32, num_tokens: 128}  # Level 0: Coarse
    - {latent_dim: 16, num_tokens: 256}  # Level 1: Medium
    - {latent_dim: 8, num_tokens: 512}   # Level 2: Fine

  # VQ-VAE hyperparameters
  commitment_cost: 0.45
  use_ema: true
  decay: 0.99
  dropout: 0.1

  # Auxiliary loss weights
  orthogonality_weight: 0.1
  informativeness_weight: 0.1

# Training
training:
  batch_size: 1024
  learning_rate: 0.0007
  num_epochs: 410
  optimizer: "adam"
  scheduler: null
  warmup_epochs: 0

  # Category assignment - AUTOMATIC via clustering
  category_assignment: "auto"
  num_categories_auto: null  # null = auto-determine via silhouette score
  orthogonality_target: 0.15  # Target max correlation between categories
  min_features_per_category: 3
  max_clusters: 25  # Maximum clusters to explore (allows 12-15 like unisim)

  # Loss weights
  reconstruction_weight: 1.0
  vq_weight: 1.0
  orthogonality_weight: 0.1
  informativeness_weight: 0.1
  topo_weight: 0.02
  topo_samples: 64

  # Checkpointing
  save_every: null  # Only save best
  checkpoint_dir: "checkpoints/vqvae_summary_1k_auto"

  # Callbacks
  early_stopping_patience: 100
  early_stopping_min_delta: 0.01
  dead_code_reset_interval: 100
  dead_code_threshold: 10.0
  dead_code_max_reset_fraction: 0.25

  # Validation
  val_every_n_epochs: 5

  # Performance
  use_torch_compile: false

# Logging
logging:
  wandb: false
  log_interval: 100
  eval_interval: 500
  verbose: true

# Random seed
random_seed: 42
