version: "1.0"

metadata:
  name: "u_afno_100k"
  description: |
    100K dataset generation using U-AFNO operators instead of CNO.
    U-AFNO combines U-Net encoder/decoder with AFNO bottleneck for
    multi-scale spatial hierarchy + global spectral mixing.

    Architecture: Input → U-Net Encoder → AFNO Bottleneck → U-Net Decoder → Output

    64×64 grid optimal for VQ-VAE compression + NOA training.
    T=256 captures transient dynamics, M=5 for statistics.
  author: "Spinlock Team"
  created: "2026-01-07"
  purpose: |
    Full 100K U-AFNO operator dataset with optimized feature extraction.

    Target: 100,000 operators × 5 realizations = 500,000 total samples
    Expected time: ~3-4s/operator = 3.5-4.6 days
    Grid: 64×64 (4× faster than 128×128, better VQ-VAE compression)

# U-AFNO parameter space (7 core dimensions)
parameter_space:
  architecture:
    base_channels:
      type: integer
      bounds: [16, 64]
      description: "Base channel count for U-Net (doubles each level)"

    encoder_levels:
      type: integer
      bounds: [2, 4]
      description: "Number of U-Net encoder/decoder levels"

    modes:
      type: integer
      bounds: [8, 32]
      description: "AFNO Fourier modes to keep (global receptive field)"

    afno_blocks:
      type: integer
      bounds: [2, 6]
      description: "Number of AFNO blocks in bottleneck"

    blocks_per_level:
      type: integer
      bounds: [1, 3]
      description: "Residual blocks per U-Net level"

    activation:
      type: choice
      choices: ["gelu"]
      description: "Activation function"

    normalization:
      type: choice
      choices: ["instance"]
      description: "Feature normalization"

  stochastic:
    noise_type:
      type: choice
      choices: ["gaussian"]
      description: "Stochastic noise distribution"

    noise_scale:
      type: continuous
      bounds: [0.00001, 1.0]
      log_scale: true
      description: "Scale of stochastic perturbations"

    noise_schedule:
      type: choice
      choices: ["constant"]
      description: "Temporal noise schedule"

    spatial_correlation:
      type: continuous
      bounds: [0.0, 0.3]
      description: "Spatial correlation length for noise"

  operator:
    grid_size:
      type: choice
      choices: [64]
      description: "Spatial grid resolution (64×64 optimal for VQ-VAE compression)"

  evolution:
    update_policy:
      type: choice
      choices: ["residual", "convex"]
      weights: [0.75, 0.25]
      description: "Temporal update policy"

# Sampling configuration for 100K samples
sampling:
  strategy: "sobol_stratified"

  sobol:
    scramble: true
    seed: 42

  stratification:
    method: "adaptive"
    num_strata_per_dim: 5
    min_samples_per_stratum: 20

  validation:
    check_discrepancy: true
    check_correlation: true

  total_samples: 100000  # 100K operators
  batch_size: 8  # Increased for better GPU utilization

# Simulation configuration
simulation:
  device: "cuda"

  operator_type: "u_afno"  # KEY: Use U-AFNO instead of CNO

  parallelism:
    strategy: "data_parallel"
    devices: "auto"

  input_generation:
    method: "sampled"

    # Equal weighting: 25% per IC family
    ic_type_weights:
      # Gaussian noise family (25% total, 5 variance levels)
      gaussian_random_field_v0: 0.05   # variance=0.25
      gaussian_random_field_v1: 0.05   # variance=0.5
      gaussian_random_field_v2: 0.05   # variance=1.0
      gaussian_random_field_v3: 0.05   # variance=2.0
      gaussian_random_field_v4: 0.05   # variance=4.0

      # Band-limited noise family (25% total, 3 bands)
      multiscale_grf_low: 0.0833
      multiscale_grf_mid: 0.0833
      multiscale_grf_high: 0.0834

      # Sinusoid family (25%)
      structured: 0.25

      # Localized blob family (25%)
      localized: 0.25

    # Gaussian noise configurations
    gaussian_random_field_v0:
      length_scale: 0.05
      variance: 0.25

    gaussian_random_field_v1:
      length_scale: 0.05
      variance: 0.5

    gaussian_random_field_v2:
      length_scale: 0.05
      variance: 1.0

    gaussian_random_field_v3:
      length_scale: 0.05
      variance: 2.0

    gaussian_random_field_v4:
      length_scale: 0.05
      variance: 4.0

    # Band-limited noise configurations
    multiscale_grf_low:
      scales: [0.30, 0.35, 0.40]
      variance: 1.0

    multiscale_grf_mid:
      scales: [0.08, 0.10, 0.12]
      variance: 1.0

    multiscale_grf_high:
      scales: [0.02, 0.025, 0.03]
      variance: 1.0

    # Sinusoid configurations
    structured:
      num_modes: 1
      wavelength_range: [8.0, 64.0]
      amplitude_range: [0.5, 2.0]

    # Localized blob configurations
    localized:
      num_blobs: 5
      min_width: 5.0
      max_width: 15.0

  num_realizations: 5  # 5 realizations for statistics (M=5 with 64×64, T=256)
  num_timesteps: 256  # Power of 2 for GPU efficiency, captures transient dynamics

# Dataset output configuration
dataset:
  output_path: "datasets/u_afno_100k.h5"

  storage:
    compression: "gzip"
    compression_level: 4
    chunk_size: 8  # Match batch_size for optimal HDF5 performance
    store_trajectories: false  # Feature-only mode (saves space)

# Feature extraction configuration
# Extract INITIAL + SUMMARY + TEMPORAL features for VQ-VAE training
features:
  initial:
    enabled: true  # Enable INITIAL family (IC features)
  temporal:
    enabled: true  # Enable TEMPORAL family (per-timestep time series)
  summary:
    enabled: true  # Enable SUMMARY family (aggregated scalars)

# Logging configuration
logging:
  level: "INFO"
  format: "structured"
