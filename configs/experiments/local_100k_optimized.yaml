version: "1.0"

metadata:
  name: "local_100k_optimized"
  description: |
    Local 100K dataset generation with v2.1 features disabled by default.
    64×64 grid optimal for VQ-VAE compression + NOA training.
    T=250 captures transient dynamics, M=5 for statistics.
  author: "Spinlock Team"
  created: "2026-01-02"
  purpose: |
    Full 100K Neural Operator dataset with optimized feature extraction.

    Target: 100,000 operators × 3 realizations = 300,000 total samples
    Expected time: ~3-4s/operator = 3.5-4.6 days
    Grid: 64×64 (4× faster than 128×128, better VQ-VAE compression)
    Memory: M=3 fits in 8GB GPU with desktop running (~4GB free)

    Features: Fast v1.0 + v2.0 + Multiscale (v2.1)
    Disabled by default: Distributional, Structural, Physics, Morphological (opt-in via config)

# 14-dimensional parameter space
parameter_space:
  architecture:
    num_layers:
      type: integer
      bounds: [2, 5]
      description: "Number of convolutional layers"

    base_channels:
      type: integer
      bounds: [16, 64]
      description: "Base number of channels"

    kernel_size:
      type: choice
      choices: [3, 5, 7]
      description: "Kernel size for convolutions"

    activation:
      type: choice
      choices: ["gelu"]
      description: "Activation function"

    dropout_rate:
      type: continuous
      bounds: [0.0, 0.3]
      description: "Dropout probability"

  stochastic:
    noise_type:
      type: choice
      choices: ["gaussian"]
      description: "Stochastic noise distribution"

    noise_scale:
      type: continuous
      bounds: [0.00001, 1.0]
      log_scale: true
      description: "Scale of stochastic perturbations"

    noise_schedule:
      type: choice
      choices: ["constant"]
      description: "Temporal noise schedule"

    spatial_correlation:
      type: continuous
      bounds: [0.0, 0.3]
      description: "Spatial correlation length for noise"

  operator:
    normalization:
      type: choice
      choices: ["instance"]
      description: "Feature normalization"

    grid_size:
      type: choice
      choices: [64]
      description: "Spatial grid resolution (64×64 optimal for VQ-VAE compression)"

  evolution:
    update_policy:
      type: choice
      choices: ["residual", "convex"]
      weights: [0.75, 0.25]
      description: "Temporal update policy"

# Sampling configuration for 100K samples
sampling:
  strategy: "sobol_stratified"

  sobol:
    scramble: true
    seed: 42

  stratification:
    method: "adaptive"
    num_strata_per_dim: 5
    min_samples_per_stratum: 20

  validation:
    check_discrepancy: true
    check_correlation: true

  total_samples: 100000  # 100K operators
  batch_size: 8  # Optimal for 64×64 grids (100000 / 8 = 12500 batches)

# Simulation configuration
simulation:
  device: "cuda"

  parallelism:
    strategy: "data_parallel"
    devices: "auto"

  input_generation:
    method: "sampled"

    # Equal weighting: 25% per IC family
    ic_type_weights:
      # Gaussian noise family (25% total, 5 variance levels)
      gaussian_random_field_v0: 0.05   # variance=0.25
      gaussian_random_field_v1: 0.05   # variance=0.5
      gaussian_random_field_v2: 0.05   # variance=1.0
      gaussian_random_field_v3: 0.05   # variance=2.0
      gaussian_random_field_v4: 0.05   # variance=4.0

      # Band-limited noise family (25% total, 3 bands)
      multiscale_grf_low: 0.0833
      multiscale_grf_mid: 0.0833
      multiscale_grf_high: 0.0834

      # Sinusoid family (25%)
      structured: 0.25

      # Localized blob family (25%)
      localized: 0.25

    # Gaussian noise configurations
    gaussian_random_field_v0:
      length_scale: 0.05
      variance: 0.25

    gaussian_random_field_v1:
      length_scale: 0.05
      variance: 0.5

    gaussian_random_field_v2:
      length_scale: 0.05
      variance: 1.0

    gaussian_random_field_v3:
      length_scale: 0.05
      variance: 2.0

    gaussian_random_field_v4:
      length_scale: 0.05
      variance: 4.0

    # Band-limited noise configurations
    multiscale_grf_low:
      scales: [0.30, 0.35, 0.40]
      variance: 1.0

    multiscale_grf_mid:
      scales: [0.08, 0.10, 0.12]
      variance: 1.0

    multiscale_grf_high:
      scales: [0.02, 0.025, 0.03]
      variance: 1.0

    # Sinusoid configurations
    structured:
      num_modes: 1
      wavelength_range: [8.0, 64.0]
      amplitude_range: [0.5, 2.0]

    # Localized blob configurations
    localized:
      num_blobs: 5
      min_width: 5.0
      max_width: 15.0

  num_realizations: 5  # 5 realizations for statistics (M=5 with 64×64, T=256)
  num_timesteps: 256  # Power of 2 for GPU efficiency, captures transient dynamics

# Dataset output configuration
dataset:
  output_path: "datasets/local_100k_optimized.h5"

  storage:
    compression: "gzip"
    compression_level: 4
    chunk_size: 8  # Match batch_size for optimal HDF5 performance
    store_trajectories: false  # Feature-only mode (saves space)

# Logging configuration
logging:
  level: "INFO"
  format: "structured"
